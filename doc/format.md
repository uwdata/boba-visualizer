# Input Format

To start the Boba Visualizer, You will need to supply your own file path, 
which points to a folder containing your multiverse outcomes and accompanying meta data. 
If you write the multiverse using the `Boba DSL`, the meta data will be 
generated for you, but you need to wrangle the multiverse outcomes in the
correct format.

## The Simplest Scenario

First, we will describe the simplest case: suppose you write the multiverse
using the Boba DSL, and you would like to visualize only one field, the point
estimates of the universes.

In this case, you do not need to provide any additional metadata, but you still need
to wrangle the point estimates in the following format. It should be a CSV file
named `estimates.csv`. In this file, each row represents a universe, and
there will be two columns: a column named `uid` that corresponds to the
integer ID of the universe, and a column named `estimate` that corresponds to
the point estimate. Here is an example:

|uid|estimate|
|---|--------|
|1  |0.04    |
|2  |-3.58   |
|3  |1.29    |
|4  |-0.87   |

Note that the `uid` of a universe must match its filename. For example, if the
filename is `universe_2.py`, the `uid` should be 2.

Now place this CSV file in the `multiverse` folder generated by the `boba compile`
command, and supply the path to this `multiverse` directory as the input argument
to the visualizer:

```
boba-server -i multiverse/
```

And you're good to go!


## Boba Merge

But how do you produce this CSV? The Boba DSL provides support for you to (1)
output a CSV file when you run each universe, and (2) merge these individual
CSV files after you've finished running all universes.

When authoring the multiverse specification, output
a csv file with just one row and one column, where the column is `estimate`
and it contains your point estimate. The trick is to use the built-in `{{_n}}`
variable in your output CSV path to create a separate file per universe.

For example, in this Boba DSL template file, we write:

```R
library(tidyverse)
library(broom.mixed)

# fit model
model <- lm(y ~ x + a + b, data=df)

# get outcomes into a table
result <- tidy(model) %>%
  filter(term == 'x')

# output
write_csv(result, 'estimate_{{_n}}.csv')
```

When we run the multiverse, `universe_1.R` will produce `estimate_1.csv`,
`universe_2.R` will produce `estimate_2.csv`, and so on.

After we finish running the multiverse, we will need to merge these separate files into
a single CSV called `estimates.csv`. This can be achieved with the `boba merge`
command:

```
boba merge estimate_{}.csv --out estimates.csv
```

For more information about the merge command, use `boba merge --help`.

## Adding More Columns

What if you would like to visualize more information besides the point estimates,
such as p-values and model fit quality? In this case, you will need to provide
a configuration file to tell the visualizer the file and the column of these fields.

We first discuss adding a field with one number per universe, for example the p-value.
The first step is to ask your multiverse to output p-values, and merge them
afterwards as a single CSV. You might name the p-value column whatever you want. Also,
p-values need not be in the same CSV as the point estimates; as long as all p-values
are in one file that has a column `uid`, it is fine. But for illustration purpose,
suppose we put p-value in the same file `estimates.csv`, like this:

|uid|estimate|p.value|
|---|--------|-------|
|1  |0.04    |0.35   |
|2  |-3.58   |0.0008 |
|3  |1.29    |0.0012 |
|4  |-0.87   |0.041  |

Then, you will need to create a JSON file for visualizer config:

```JSON
{
  "files": [
    {"id": "EST", "path": "estimates.csv"}
  ],
  "schema": {
    "point_estimate": {"file": "EST", "field": "estimate"},
    "p_value": {"file": "EST", "field": "p.value"}
  }
}
```

In this config, `files` contains the path to our CSV file(s). In this case, we
only have one CSV file, and we provide a relative path to our `multiverse` folder.
`schema` tells the visualizer where the corresponding fields are located.
For example, `p_value` is located in the `p.value` column of the `estimates.csv`
file. Note that we do not directly fill in the filename, but the `id` of the
file, to reduce redundancy (it's like database normalization).

For a complete list of valid schema fields, see 
[here](https://github.com/uwdata/boba-visualizer/tree/master/doc/visualizer_config.md). 

## Without the Boba DSL

What if you did not author the multiverse using the Boba DSL? ...

(More content to come)